<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>Lab 1.1: Email Header Analysis - SOC Analyst I</title>
  
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  
  <link rel="stylesheet" href="styles.css">

  <style>
    /* Local overrides for the tutorial interaction */
    .step-content {
      display: none; /* Hidden by default */
      animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .step-header {
      cursor: pointer; /* Make it obvious it's clickable */
    }

    .step-header:hover {
      background: rgba(255,255,255,0.05);
    }

    /* Syntax highlighting for the header analysis */
    .highlight-red { color: #ef4444; font-weight: bold; }
    .highlight-green { color: #10b981; font-weight: bold; }
    .highlight-yellow { color: #f59e0b; font-weight: bold; }
  </style>
</head>
<body class="dark">
  <nav class="site-nav">
    <div class="logo">SOC Analyst I</div>
    <ul class="nav-links">
      <li><a href="index.html">Home</a></li>
      <li><a href="modules.html">Modules</a></li>
      <li><a href="lab.html" class="active">Labs</a></li>
      <li><a href="dashboard.html">Progress</a></li>
      <li><a href="portfolio.html">Portfolio</a></li>
    </ul>
  </nav>

  <main class="tutorial-page">
    <div class="container"> <header class="tutorial-header">
        <div class="breadcrumb">
          <a href="lab.html">‚Üê Back to Labs</a>
        </div>
        <div class="tutorial-meta">
          <span class="badge badge-in-progress">Module 1: Phishing Attack</span>
          <span class="module-number">Lab 1.1</span>
        </div>
        <h1>Email Header Analysis & Spoofing Detection</h1>
        <p class="tutorial-subtitle">Master the art of reading raw email headers to identify the true origin of a message and detect spoofing attempts.</p>
        
        <div class="lab-meta" style="border:none; padding:0; margin-top:1rem;">
          <span>‚è±Ô∏è 45 Minutes</span>
          <span>üü° Intermediate</span>
          <span>üìä Progress: <span id="progress-percent">0%</span></span>
        </div>
      </header>

      <section class="real-world-context module-card" style="margin-bottom: 2rem;">
        <h3>üåç Real-World Scenario</h3>
        <p>A Finance Department employee, <strong>Sarah Jenkins</strong>, reported a suspicious email claiming to be from the CEO, requesting an urgent wire transfer. The email address looks correct (`ceo@company.com`), but the tone feels off.</p>
        <p><strong>Your Mission:</strong> Analyze the raw email headers to determine if this email actually originated from your company's mail server or if it's a spoofed attack from an external threat actor.</p>
      </section>

      <section class="tutorial-steps">
        
        <div class="tutorial-step" id="step-1">
          <div class="step-header" onclick="toggleStep(1)">
            <span class="step-number">1</span>
            <div style="flex-grow:1">
              <h3>The "Envelope" vs. The "Letter"</h3>
              <p style="margin:0; font-size:0.9rem; color:var(--text-muted)">Understanding From vs. Return-Path</p>
            </div>
            <button class="btn-secondary btn-sm step-toggle">Expand</button>
          </div>
          
          <div class="step-content">
            <div class="content-section">
              <h4>Concept</h4>
              <p>Email has two "senders":</p>
              <ul>
                <li><strong>Header From:</strong> What the user sees in Outlook/Gmail. (Easily faked).</li>
                <li><strong>Return-Path (Envelope From):</strong> Where bounce messages go. (Harder to fake, often reveals the true sender).</li>
              </ul>
              
              <div class="code-block">
<pre>
Return-Path: <span class="highlight-red">&lt;evil-mailer@attacker-infrastructure.net&gt;</span>  <-- TRUE SENDER
From: "CEO John Doe" <span class="highlight-green">&lt;ceo@company.com&gt;</span>               <-- WHAT VICTIM SEES
Subject: URGENT WIRE TRANSFER
</pre>
              </div>

              <p>In a spoofing attack, these two fields often mismatch. The attacker puts the CEO's email in the <code>From</code> field, but their own server uses the <code>Return-Path</code> to handle delivery errors.</p>
            </div>

            <div class="lab-action module-card" style="border-color: var(--primary);">
              <h4>‚úÖ Action Item</h4>
              <p>Look at the raw header provided in your lab data pack. Does the <code>Return-Path</code> match the <code>From</code> address?</p>
              <label class="checkbox-label" style="display:flex; gap:10px; align-items:center; cursor:pointer;">
                <input type="checkbox" class="step-checkbox" onchange="updateProgress()">
                <span>I have identified the mismatch between From and Return-Path.</span>
              </label>
            </div>
          </div>
        </div>

        <div class="tutorial-step" id="step-2">
          <div class="step-header" onclick="toggleStep(2)">
            <span class="step-number">2</span>
            <div style="flex-grow:1">
              <h3>Tracing the Route (Received Headers)</h3>
              <p style="margin:0; font-size:0.9rem; color:var(--text-muted)">Reading bottom-to-top</p>
            </div>
            <button class="btn-secondary btn-sm step-toggle">Expand</button>
          </div>
          
          <div class="step-content">
            <div class="content-section">
              <h4>Concept</h4>
              <p>Every server that touches an email stamps it with a <code>Received</code> header. To trace an email back to its origin, you must read these headers from <strong>Bottom to Top</strong>.</p>
              
              <div class="code-block">
<pre>
1. Received: from mail.company.com ... (Internal Server - Last Hop)
2. Received: from spam-filter.cloud ... (Security Gateway)
3. Received: from <span class="highlight-red">mail-relay.attacker.com [192.0.2.55]</span> ... (ORIGINATING IP)
</pre>
              </div>

              <p>The bottom-most <code>Received</code> header usually contains the <strong>Source IP</strong> (X-Originating-IP). You should take this IP and run it through OSINT tools like AbuseIPDB or VirusTotal.</p>
            </div>

            <div class="lab-action module-card" style="border-color: var(--primary);">
              <h4>‚úÖ Action Item</h4>
              <p>Identify the bottom-most Received header. Extract the IP address inside the brackets <code>[]</code>.</p>
              <div style="margin: 1rem 0;">
                <input type="text" placeholder="Enter Originating IP..." style="background:var(--bg-dark); border:1px solid var(--border-color); padding:0.5rem; color:#fff; width:100%; border-radius:6px;">
              </div>
              <label class="checkbox-label" style="display:flex; gap:10px; align-items:center; cursor:pointer;">
                <input type="checkbox" class="step-checkbox" onchange="updateProgress()">
                <span>I have extracted the Source IP.</span>
              </label>
            </div>
          </div>
        </div>

        <div class="tutorial-step" id="step-3">
          <div class="step-header" onclick="toggleStep(3)">
            <span class="step-number">3</span>
            <div style="flex-grow:1">
              <h3>Authentication Checks (SPF & DKIM)</h3>
              <p style="margin:0; font-size:0.9rem; color:var(--text-muted)">The "Smoking Gun" of spoofing</p>
            </div>
            <button class="btn-secondary btn-sm step-toggle">Expand</button>
          </div>
          
          <div class="step-content">
            <div class="content-section">
              <h4>Concept</h4>
              <p>Modern email security relies on SPF (Sender Policy Framework) to verify if an IP is allowed to send email for a specific domain.</p>
              
              <ul>
                <li><strong>SPF Pass:</strong> The source IP is authorized. (Likely legitimate).</li>
                <li><strong>SPF Softfail/Fail:</strong> The source IP is NOT authorized. (High probability of spoofing).</li>
              </ul>

              <div class="code-block">
<pre>
Authentication-Results: mx.google.com;
       dkim=neutral (no signature);
       spf=<span class="highlight-red">softfail</span> (google.com: domain of moving-service@gmail.com does not designate 192.0.2.55 as permitted sender)
</pre>
              </div>
            </div>

            <div class="lab-action module-card" style="border-color: var(--primary);">
              <h4>‚úÖ Action Item</h4>
              <p>Locate the <code>Authentication-Results</code> or <code>Received-SPF</code> header. Did the email pass or fail SPF?</p>
              <label class="checkbox-label" style="display:flex; gap:10px; align-items:center; cursor:pointer;">
                <input type="checkbox" class="step-checkbox" onchange="updateProgress()">
                <span>I have confirmed the SPF/DKIM status.</span>
              </label>
            </div>
          </div>
        </div>

        <section class="lab-completion module-card">
          <h3>üéì Analysis Conclusion</h3>
          <p>Based on your findings (Mismatched Return-Path, Source IP reputation, and SPF Failure), this email is a confirmed <strong>CEO Fraud / BEC (Business Email Compromise)</strong> attempt.</p>
          <div class="completion-actions" style="margin-top:1.5rem;">
            <button class="btn-primary" onclick="alert('Lab Completed! Progress Saved.')">Submit Findings</button>
            <a href="lab.html" class="btn-secondary">Return to Labs</a>
          </div>
        </section>

      </section>
    </div>
  </main>

  <footer class="site-footer">
    <p>&copy; 2025 SOC Analyst I ‚Äî From Cradle to Grave. All rights reserved.</p>
  </footer>

  <script>
    // Toggle Step Logic
    function toggleStep(stepId) {
      const stepElement = document.getElementById(`step-${stepId}`);
      const content = stepElement.querySelector('.step-content');
      const button = stepElement.querySelector('.step-toggle');
      
      // Check current state
      const isHidden = content.style.display === 'none' || content.style.display === '';
      
      if (isHidden) {
        content.style.display = 'block';
        button.textContent = 'Collapse';
        button.style.background = 'rgba(255,255,255,0.1)';
      } else {
        content.style.display = 'none';
        button.textContent = 'Expand';
        button.style.background = '';
      }
    }

    // Progress Bar Logic
    function updateProgress() {
      const checkboxes = document.querySelectorAll('.step-checkbox');
      const total = checkboxes.length;
      let checked = 0;
      
      checkboxes.forEach(box => {
        if(box.checked) checked++;
      });
      
      const percent = Math.round((checked / total) * 100);
      document.getElementById('progress-percent').textContent = percent + '%';
      
      // Optional: Save to local storage
      localStorage.setItem('lab1.1_progress', percent);
    }

    // Initialize - Check for saved progress
    document.addEventListener('DOMContentLoaded', () => {
      // Ensure all steps are collapsed initially
      document.querySelectorAll('.step-content').forEach(el => el.style.display = 'none');
      
      // Restore progress if any (simple implementation)
      const saved = localStorage.getItem('lab1.1_progress');
      if(saved) {
        document.getElementById('progress-percent').textContent = saved + '%';
      }
    });
  </script>
</body>
</html>
